<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜¥å¨‡ä¸å¿—æ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ç²’å­æ•ˆæœç›¸å…³æ ·å¼ */
        .sparkle {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            pointer-events: none;
            opacity: 1;
        }
        
        .heart-particle {
            position: absolute;
            pointer-events: none;
            opacity: 1;
            font-size: 16px;
        }
        
        /* ä¼˜åŒ–æŒ‰é’®äº¤äº’çš„åŠ¨ç”» */
        @keyframes buttonPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 46, 99, 0.8);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(255, 46, 99, 1);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 46, 99, 0.8);
            }
        }
        
        #yes-button:hover {
            animation: buttonPulse 1s ease-in-out infinite;
        }
        
        /* éŸ³ä¹æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 46, 99, 0.8);
            border-radius: 50%;
            display: none; /* éšè—éŸ³ä¹æ§åˆ¶æŒ‰é’® */
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 46, 99, 0.8);
        }
        
        .music-control:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 46, 99, 1);
        }
        
        .music-icon {
            width: 20px;
            height: 20px;
            border-left: 8px solid #fff;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            margin-left: 3px;
        }
        
        .music-icon.paused::before, .music-icon.paused::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 20px;
            background-color: #fff;
        }
        
        .music-icon.paused::before {
            left: 18px;
        }
        
        .music-icon.paused::after {
            right: 18px;
        }
        
        .music-icon.paused {
            border: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- éŸ³ä¹æ’­æ”¾å…ƒç´  -->
    <audio id="bg-music" loop>
        <source src="æ˜¥å¨‡ä¸å¿—æ˜.mp3" type="audio/mpeg">
    </audio>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control">
        <div class="music-icon"></div>
    </div>
    
    <canvas id="canvas" style="position: fixed; top: 0; left: 0; z-index: -1;"></canvas>
    
    <!-- ä¸»å†…å®¹å®¹å™¨ -->
    <div id="main-container" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #ff6b6b, #ff8e53, #feb47b);">
        <!-- å¿ƒå½¢åŠ¨ç”»åŒºåŸŸ -->
        <div id="heart-container" style="position: relative; display: flex; justify-content: center; align-items: center;">
            <svg id="heart-svg" width="300" height="300" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke="#fff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="fill: transparent; stroke-dasharray: 1000; stroke-dashoffset: 1000;">
                </path>
            </svg>
            <div id="text-overlay" style="position: absolute; text-align: center; opacity: 0; transform: scale(0.8); transition: all 0.5s ease;">
                <h1 style="color: white; font-family: 'Microsoft YaHei', sans-serif; font-size: 24px; margin-bottom: 10px;">é˜¿å¸¸ï¼Œåšæˆ‘å¥³æœ‹å‹å¥½å—ï¼Ÿ</h1>
                <p style="color: white; font-family: 'Microsoft YaHei', sans-serif; font-size: 16px;">æˆ‘å–œæ¬¢ä½ å¾ˆä¹…äº†</p>
            </div>
        </div>
    </div>
    
    <!-- æŒ‰é’®åŒºåŸŸ -->
    <div id="buttons-container" style="position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; opacity: 0; transition: opacity 1s ease;">
        <button id="yes-button" style="padding: 15px 40px; font-size: 18px; background-color: #ff427f; color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px rgba(255, 46, 99, 0.8); transition: all 0.3s ease;">
            å¯ä»¥
        </button>
        <button id="no-button" style="padding: 15px 40px; font-size: 18px; background-color: #666; color: white; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease;">
            å†è€ƒè™‘ä¸€ä¸‹
        </button>
    </div>
    
    <!-- è®¢å•è¡¨å•å¼¹çª— -->
    <div id="order-form" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 500px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);">
            <h2 style="text-align: center; color: #ff427f; margin-bottom: 20px; font-family: 'Microsoft YaHei', sans-serif;">å¡«å†™ä½ çš„ä¿¡æ¯</h2>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-family: 'Microsoft YaHei', sans-serif;">åœ°å€</label>
                <input type="text" id="address" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;" placeholder="è¯·è¾“å…¥ä½ çš„åœ°å€">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-family: 'Microsoft YaHei', sans-serif;">æ‰‹æœºå·</label>
                <input type="tel" id="phone" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;" placeholder="è¯·è¾“å…¥ä½ çš„æ‰‹æœºå·">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-family: 'Microsoft YaHei', sans-serif;">æƒ³å¯¹é˜¿å¸¸è¯´çš„è¯</label>
                <textarea id="message" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; min-height: 100px; resize: vertical;" placeholder="æƒ³è¯´ç‚¹ä»€ä¹ˆå—ï¼Ÿ"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-family: 'Microsoft YaHei', sans-serif;">å¹¸è¿å¥–å“</label>
                <select id="prize" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background-color: white;">
                    <option value="çˆ±æƒ…å¥¶èŒ¶">çˆ±æƒ…å¥¶èŒ¶</option>
                    <option value="çœŸå¿ƒå·§å…‹åŠ›">çœŸå¿ƒå·§å…‹åŠ›</option>
                    <option value="å¹¸ç¦ç³–æœ">å¹¸ç¦ç³–æœ</option>
                    <option value="æµªæ¼«é²œèŠ±">æµªæ¼«é²œèŠ±</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button id="submit-order" style="flex: 1; padding: 15px; font-size: 16px; background-color: #ff427f; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;">ç¡®å®š</button>
                <button id="cancel-order" style="flex: 1; padding: 15px; font-size: 16px; background-color: #666; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ•°æ®å±•ç¤ºé¢æ¿ -->
    <div id="data-panel" style="position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); z-index: 99; transition: all 0.3s ease;">
        <span style="font-size: 20px; color: #ff427f;">ğŸ“‹</span>
    </div>
    
    <!-- æ•°æ®å±•ç¤ºå¼¹çª— -->
    <div id="data-display" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #ff427f; font-family: 'Microsoft YaHei', sans-serif;">æäº¤è®°å½•</h2>
                <button id="close-data" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
            </div>
            
            <div id="data-list" style="font-family: 'Microsoft YaHei', sans-serif;">
                <!-- æ•°æ®è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <script>
        // å¿ƒå½¢ç»˜åˆ¶åŠ¨ç”»
        const heartPath = document.querySelector('#heart-svg path');
        const textOverlay = document.querySelector('#text-overlay');
        const buttonsContainer = document.querySelector('#buttons-container');
        
        // å¼€å§‹ç»˜åˆ¶å¿ƒå½¢
        function drawHeart() {
            let offset = 1000;
            const interval = setInterval(() => {
                offset -= 20;
                heartPath.style.strokeDashoffset = offset;
                
                if (offset <= 0) {
                    clearInterval(interval);
                    // å¿ƒå½¢ç»˜åˆ¶å®Œæˆåå¡«å……é¢œè‰²
                    heartPath.style.fill = '#ff427f';
                    // æ˜¾ç¤ºæ–‡å­—å’ŒæŒ‰é’®
                    setTimeout(() => {
                        textOverlay.style.opacity = 1;
                        textOverlay.style.transform = 'scale(1)';
                        setTimeout(() => {
                            buttonsContainer.style.opacity = 1;
                        }, 500);
                    }, 500);
                }
            }, 30);
        }
        
        // éŸ³ä¹æ§åˆ¶åŠŸèƒ½
        const bgMusic = document.getElementById('bg-music');
        const musicControl = document.querySelector('.music-control');
        const musicIcon = document.querySelector('.music-icon');
        
        function toggleMusic() {
            if (bgMusic.paused) {
                bgMusic.play();
                musicIcon.classList.remove('paused');
            } else {
                bgMusic.pause();
                musicIcon.classList.add('paused');
            }
        }
        
        musicControl.addEventListener('click', toggleMusic);
        
        // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
        document.addEventListener('click', function startMusic() {
            bgMusic.play().then(() => {
                musicControl.style.display = 'flex';
                document.removeEventListener('click', startMusic);
            }).catch(error => {
                console.log('æ— æ³•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹:', error);
            });
        }, { once: true });
        
        // ç”Ÿæˆæ˜Ÿæ˜Ÿæ•£è½æ•ˆæœ
        function createSparkles(x, y) {
            const container = document.body;
            
            for (let i = 0; i < 100; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                
                // éšæœºå¤§å°
                const size = Math.random() * 6 + 2;
                sparkle.style.width = `${size}px`;
                sparkle.style.height = `${size}px`;
                
                // åˆå§‹ä½ç½®
                sparkle.style.left = `${x}px`;
                sparkle.style.top = `${y}px`;
                
                // éšæœºé¢œè‰²ï¼ˆç²‰è‰²è°ƒï¼‰
                const hue = Math.random() * 30 + 330; // ç²‰è‰²èŒƒå›´
                const brightness = Math.random() * 20 + 80; // äº®åº¦
                sparkle.style.backgroundColor = `hsl(${hue}, 100%, ${brightness}%)`;
                
                container.appendChild(sparkle);
                
                // éšæœºæ–¹å‘å’Œè·ç¦»
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 150 + 50;
                const finalX = x + Math.cos(angle) * distance;
                const finalY = y + Math.sin(angle) * distance;
                
                // åŠ¨ç”»
                const duration = Math.random() * 1000 + 1000;
                
                sparkle.animate([
                    { transform: `translate(0, 0)`, opacity: 1 },
                    { transform: `translate(${finalX - x}px, ${finalY - y}px)`, opacity: 0 }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
                });
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    container.removeChild(sparkle);
                }, duration);
            }
            
            // åˆ›å»ºå¿ƒå½¢ç²’å­
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.classList.add('heart-particle');
                heart.textContent = 'â¤ï¸';
                
                // åˆå§‹ä½ç½®
                heart.style.left = `${x}px`;
                heart.style.top = `${y}px`;
                
                container.appendChild(heart);
                
                // éšæœºæ–¹å‘å’Œè·ç¦»
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 100 + 30;
                const finalX = x + Math.cos(angle) * distance;
                const finalY = y + Math.sin(angle) * distance;
                
                // åŠ¨ç”»
                const duration = Math.random() * 1500 + 1500;
                
                heart.animate([
                    { transform: `translate(0, 0) rotate(0deg)`, opacity: 1, fontSize: '16px' },
                    { transform: `translate(${finalX - x}px, ${finalY - y}px) rotate(360deg)`, opacity: 0, fontSize: '24px' }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
                });
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    container.removeChild(heart);
                }, duration);
            }
        }
        
        // æŒ‰é’®äº¤äº’
        const yesButton = document.getElementById('yes-button');
        const noButton = document.getElementById('no-button');
        const orderForm = document.getElementById('order-form');
        const submitOrder = document.getElementById('submit-order');
        const cancelOrder = document.getElementById('cancel-order');
        
        yesButton.addEventListener('click', function(e) {
            // è·å–æŒ‰é’®ä½ç½®
            const rect = e.target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            
            // åˆ›å»ºæ˜Ÿæ˜Ÿæ•ˆæœ
            createSparkles(x, y);
            
            // æ˜¾ç¤ºè®¢å•è¡¨å•
            setTimeout(() => {
                orderForm.style.display = 'flex';
            }, 1500);
        });
        
        // è®©"å†è€ƒè™‘ä¸€ä¸‹"æŒ‰é’®é€ƒè·‘
        noButton.addEventListener('mouseover', function() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const buttonWidth = this.offsetWidth;
            const buttonHeight = this.offsetHeight;
            
            // è®¡ç®—å®‰å…¨åŒºåŸŸï¼ˆè·ç¦»è¾¹ç¼˜æœ‰ä¸€å®šè·ç¦»ï¼‰
            const maxX = windowWidth - buttonWidth - 20;
            const maxY = windowHeight - buttonHeight - 20;
            
            // éšæœºç”Ÿæˆæ–°ä½ç½®
            const newX = Math.random() * maxX + 10;
            const newY = Math.random() * maxY + 10;
            
            // è®¾ç½®æ–°ä½ç½®
            this.style.position = 'fixed';
            this.style.left = `${newX}px`;
            this.style.top = `${newY}px`;
            this.style.bottom = 'auto';
            this.style.transform = 'none';
        });
        
        // å–æ¶ˆè®¢å•
        cancelOrder.addEventListener('click', function() {
            orderForm.style.display = 'none';
        });
        
        // é˜»æ­¢è¡¨å•åœ¨ç‚¹å‡»å†…éƒ¨æ—¶å…³é—­
        orderForm.addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
        
        // æ•°æ®é¢æ¿äº¤äº’
        const dataPanel = document.getElementById('data-panel');
        const dataDisplay = document.getElementById('data-display');
        const closeData = document.getElementById('close-data');
        const dataList = document.getElementById('data-list');
        
        dataPanel.addEventListener('click', function() {
            dataDisplay.style.display = 'flex';
            updateDataPanel();
        });
        
        closeData.addEventListener('click', function() {
            dataDisplay.style.display = 'none';
        });
        
        dataDisplay.addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
        
        // ä¿å­˜è®¢å•æ•°æ®
        function saveOrderData(userInfo) {
            // è·å–ç°æœ‰æ•°æ®
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            // æ·»åŠ æ–°è®¢å•
            orders.push({
                ...userInfo,
                timestamp: new Date().toISOString()
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // æ›´æ–°æ•°æ®é¢æ¿
            updateDataPanel();
        }
        
        // æ›´æ–°æ•°æ®é¢æ¿
        function updateDataPanel() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            if (orders.length === 0) {
                dataList.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— æ•°æ®</p>';
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // ç”ŸæˆHTML
            let html = '';
            orders.forEach((order, index) => {
                const date = new Date(order.timestamp).toLocaleString('zh-CN');
                html += `
                    <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <h3 style="color: #ff427f; margin: 0;">è®¢å• #${index + 1}</h3>
                            <span style="color: #999; font-size: 14px;">${date}</span>
                        </div>
                        <p><strong>åœ°å€:</strong> ${order.address}</p>
                        <p><strong>æ‰‹æœºå·:</strong> ${order.phone}</p>
                        <p><strong>æƒ³å¯¹é˜¿å¸¸è¯´çš„è¯:</strong> ${order.message}</p>
                        <p><strong>å¹¸è¿å¥–å“:</strong> ${order.prize}</p>
                    </div>
                `;
            });
            
            dataList.innerHTML = html;
        }
        
        // æäº¤è®¢å•
        submitOrder.addEventListener('click', function() {
            const address = document.getElementById('address').value;
            const phone = document.getElementById('phone').value;
            const message = document.getElementById('message').value;
            const prize = document.getElementById('prize').value;
            
            // ç®€å•éªŒè¯
            if (!address || !phone) {
                alert('è¯·å¡«å†™åœ°å€å’Œæ‰‹æœºå·');
                return;
            }
            
            // ä¿å­˜æ•°æ®
            const userInfo = {
                address,
                phone,
                message: message || 'æš‚æ— ç•™è¨€',
                prize
            };
            
            saveOrderData(userInfo);
            
            // å‘é€é‚®ä»¶
            sendEmail(userInfo);
            
            // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯å¹¶å…³é—­è¡¨å•
            alert('æäº¤æˆåŠŸï¼');
            orderForm.style.display = 'none';
            
            // é‡ç½®è¡¨å•
            document.getElementById('address').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('message').value = '';
            document.getElementById('prize').selectedIndex = 0;
        });
        
        // å‘é€é‚®ä»¶å‡½æ•°
        async function sendEmail(userInfo) {
            try {
                const response = await fetch('/.netlify/functions/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userInfo)
                });
                
                if (!response.ok) {
                    throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                }
                
                const result = await response.json();
                console.log('é‚®ä»¶å‘é€æˆåŠŸ:', result);
            } catch (error) {
                console.error('é‚®ä»¶å‘é€å¤±è´¥:', error);
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            drawHeart();
            
            // åˆ›å»ºèƒŒæ™¯ç²’å­æ•ˆæœ
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå¤§å°
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // åˆ›å»ºç²’å­æ•°ç»„
            const particlesArray = [];
            const numberOfParticles = 100;
            
            // ç²’å­ç±»
            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 5 + 1;
                    this.speedX = Math.random() * 3 - 1.5;
                    this.speedY = Math.random() * 3 - 1.5;
                    // éšæœºç²‰è‰²è°ƒ
                    this.color = `hsl(${Math.random() * 30 + 330}, 100%, ${Math.random() * 20 + 70}%)`;
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    
                    if (this.size > 0.2) this.size -= 0.01;
                    
                    // è¾¹ç•Œæ£€æµ‹
                    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                }
                
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // åˆ›å»ºç²’å­
            function init() {
                for (let i = 0; i < numberOfParticles; i++) {
                    particlesArray.push(new Particle());
                }
            }
            
            // è¿æ¥ç²’å­æ•ˆæœ
            function connectParticles() {
                for (let a = 0; a < particlesArray.length; a++) {
                    for (let b = a; b < particlesArray.length; b++) {
                        const dx = particlesArray[a].x - particlesArray[b].x;
                        const dy = particlesArray[a].y - particlesArray[b].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 100) {
                            ctx.strokeStyle = `rgba(255, 66, 127, ${0.8 - distance/100})`;
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
                            ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
                            ctx.stroke();
                        }
                    }
                }
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                for (let i = 0; i < particlesArray.length; i++) {
                    particlesArray[i].update();
                    particlesArray[i].draw();
                }
                
                connectParticles();
                
                // æ·»åŠ æ–°ç²’å­
                if (particlesArray.length < numberOfParticles) {
                    particlesArray.push(new Particle());
                }
                
                // ç§»é™¤è¿‡å°çš„ç²’å­
                for (let i = particlesArray.length - 1; i >= 0; i--) {
                    if (particlesArray[i].size <= 0.2) {
                        particlesArray.splice(i, 1);
                    }
                }
                
                requestAnimationFrame(animate);
            }
            
            // å¯åŠ¨åŠ¨ç”»
            init();
            animate();
        });
    </script>
</body>
</html>